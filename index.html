<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©¬åŸåˆ·é¢˜å·¥å…·</title>
    <!-- å¼•å…¥å¤–éƒ¨çš„ Alpine.js æ¡†æ¶ -->
    <script src="//unpkg.com/alpinejs" defer></script>
    <!-- å¼•å…¥æ‚¨çš„é¢˜åº“æ–‡ä»¶ -->
    <script src="./ans.js"></script>
    <script src="./utils.js"></script>
    <!-- å¼•å…¥å¤–éƒ¨çš„æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="./style.css">
    <style>
        /* è‡ªå®šä¹‰çš„ä¸€äº›å°æ ·å¼ï¼Œç”¨äºä¼˜åŒ–ä½“éªŒ */
        .option-label {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-width: 1px;
            border-radius: 0.5rem;
            cursor: pointer;
            transition-property: background-color, border-color;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 200ms;
        }

        .option-label-multi:has(input:checked) {
            background-color: oklch(from var(--color-primary) l c h / 15%);
        }

        .text-green-500 {
            color: #22c55e;
        }

        .text-red-500 {
            color: #ef4444;
        }

        .font-bold {
            font-weight: 700;
        }
    </style>
</head>

<body class="p-4 bg-base-200">
<!-- æ•´ä¸ªåº”ç”¨çš„ä¸»å®¹å™¨ -->
<div x-data="app()" x-init="init()" class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-6">é©¬åŸåˆ·é¢˜å·¥å…·</h1>

    <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
    <div class="text-center my-4 space-x-2">
        <button @click="setMode('view')" class="btn" :class="{'btn-primary': mode === 'view'}">
            ğŸ“š æŸ¥çœ‹é¢˜åº“
        </button>
        <button @click="setMode('brush')" class="btn" :class="{'btn-primary': mode === 'brush'}">
            âœï¸ éšæœºåˆ·é¢˜
        </button>
        <button @click="setMode('wrong')" class="btn" :class="{'btn-primary': mode === 'wrong'}">
            ğŸ”¥ é”™é¢˜ç»ƒä¹  <span class="badge" x-text="wrongQuestionCount"></span>
        </button>
    </div>

    <!-- ======================= æŸ¥çœ‹é¢˜åº“æ¨¡å¼ ======================= -->
    <div x-show="mode === 'view'">
        <template x-for="chapter in chapters" :key="chapter.name">
            <div class="collapse collapse-arrow bg-base-100 mb-2">
                <input type="checkbox"/>
                <div class="collapse-title text-xl font-medium" x-text="chapter.name"></div>
                <div class="collapse-content">
                    <template x-for="(q, index) in chapter.list" :key="index">
                        <div class="border-t border-base-300 py-4">
                            <p class="font-semibold" x-text="q[0]"></p>
                            <div class="mt-2 space-y-1">
                                <template x-for="item in q.slice(1, -2)">
                                    <p :class="isHighlight(item, q[q.length - 2]) ? 'text-green-500 font-bold' : ''"
                                       x-text="item"></p>
                                </template>
                            </div>
                            <p class="mt-2 font-bold text-green-500" x-text="q[q.length - 2]"></p>
                        </div>
                    </template>
                </div>
            </div>
        </template>
    </div>

    <!-- ======================= éšæœºåˆ·é¢˜æ¨¡å¼ ======================= -->
    <div x-show="mode === 'brush'">
        <div x-show="!brush.isPracticeStarted" class="card bg-base-100 p-6 text-center">
            <h3 class="text-xl font-semibold mb-4">è¯·é€‰æ‹©è¦ç»ƒä¹ çš„é¢˜å‹</h3>
            <div class="flex flex-wrap justify-center gap-4">
                <button @click="brush.startPracticeByType('single')" class="btn btn-outline btn-primary">å•é€‰é¢˜</button>
                <button @click="brush.startPracticeByType('multiple')" class="btn btn-outline btn-secondary">å¤šé€‰é¢˜
                </button>
                <button @click="brush.startPracticeByType('judge')" class="btn btn-outline btn-accent">åˆ¤æ–­é¢˜</button>
                <button @click="brush.startPracticeByType('all')" class="btn btn-neutral">å…¨éƒ¨é¢˜å‹</button>
            </div>
        </div>

        <div x-show="brush.isPracticeStarted">
            <!-- V V V è¿™é‡Œæ˜¯ä¿®æ”¹çš„åœ°æ–¹ V V V -->
            <div x-show="brush.currentQuestion"
                 class="text-center font-bold text-lg my-4 p-2 bg-info/20 text-info-content rounded-lg"
                 x-text="brush.sectionTitle" x-transition>
            </div>

            <div x-show="brush.currentQuestion" class="card bg-base-100" x-transition>
                <div class="card-body">
                    <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                        <h2 class="card-title">éšæœºç»ƒä¹ </h2>
                        <div class="text-sm font-semibold">
                            <span>è¿›åº¦: <span x-text="brush.currentQuestionIndex + 1"></span> / <span
                                    x-text="brush.stats.total"></span></span> |
                            <span class="text-green-500">æ­£ç¡®: <span x-text="brush.stats.correct"></span></span> |
                            <span class="text-red-500">é”™è¯¯: <span x-text="brush.stats.incorrect"></span></span>
                        </div>
                    </div>
                    <div class="p-4 border rounded-lg bg-base-200">
                        <p class="font-semibold text-lg mb-4" x-text="brush.displayQuestionText"></p>
                        <div class="space-y-2">
                            <template
                                    x-if="brush.currentQuestion.type === 'single' || brush.currentQuestion.type === 'judge'">
                                <template x-for="option in brush.currentQuestion.options" :key="option">
                                    <label @click.prevent="brush.selectAndCheck(option.charAt(0))" class="option-label"
                                           :class="brush.getOptionClass(option)">
                                        <span x-text="option"></span>
                                    </label>
                                </template>
                            </template>
                            <template x-if="brush.currentQuestion.type === 'multiple'">
                                <template x-for="option in brush.currentQuestion.options" :key="option">
                                    <label class="option-label option-label-multi"
                                           :class="brush.getOptionClass(option)">
                                        <input type="checkbox" :value="option.charAt(0)" x-model="brush.userSelection"
                                               class="checkbox checkbox-primary mr-3" :disabled="brush.isAnswerChecked">
                                        <span x-text="option"></span>
                                    </label>
                                </template>
                            </template>
                        </div>
                    </div>
                    <div x-show="brush.isAnswerChecked"
                         class="mt-4 p-3 rounded-lg font-bold"
                         :class="{ 'bg-green-100 text-green-800': brush.isCorrect, 'bg-red-100 text-red-800': !brush.isCorrect }"
                         x-transition>
                        æ­£ç¡®ç­”æ¡ˆ: <span x-text="brush.currentQuestion.correctAnswer"></span>
                    </div>
                    <!-- V V V è¿™é‡Œæ˜¯ä¿®æ”¹çš„åœ°æ–¹ V V V -->
                    <div class="card-actions justify-between mt-6">
                        <button @click="brush.reset()" class="btn btn-ghost">è¿”å›</button>
                        <div>
                            <button @click="brush.prevQuestion()" class="btn"
                                    :disabled="brush.currentQuestionIndex <= 0">â† ä¸Šä¸€é¢˜
                            </button>
                            <button @click="brush.nextQuestion()" class="btn btn-secondary"
                                    :disabled="brush.currentQuestionIndex >= brush.practicePool.length - 1">ä¸‹ä¸€é¢˜ â†’
                            </button>
                            <button @click="brush.checkAnswer()"
                                    x-show="brush.currentQuestion && brush.currentQuestion.type === 'multiple' && !brush.isAnswerChecked"
                                    class="btn btn-primary mx-2">æäº¤
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å®Œæˆç•Œé¢ -->
            <div x-show="!brush.currentQuestion && brush.isPracticeStarted" class="card bg-base-100 text-center p-8"
                 x-transition>
                <h2 class="card-title text-2xl mx-auto">ğŸ‰ ç»ƒä¹ å®Œæˆ! ğŸ‰</h2>
                <div class="stats shadow mx-auto my-4">
                    <div class="stat">
                        <div class="stat-title">æ€»é¢˜æ•°</div>
                        <div class="stat-value" x-text="brush.stats.total"></div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">æ­£ç¡®</div>
                        <div class="stat-value text-green-500" x-text="brush.stats.correct"></div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">é”™è¯¯</div>
                        <div class="stat-value text-red-500" x-text="brush.stats.incorrect"></div>
                    </div>
                </div>
                <div class="card-actions justify-center mt-6">
                    <button @click="brush.reset()" class="btn btn-primary">å†æ¥ä¸€è½®</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================= é”™é¢˜ç»ƒä¹ æ¨¡å¼ ======================= -->
    <div x-show="mode === 'wrong'">
        <div x-show="!wrongBrush.isPracticeStarted && !wrongBrush.isEmpty" class="card bg-base-100 p-6 text-center">
            <h3 class="text-xl font-semibold mb-4">è¯·é€‰æ‹©è¦ç»ƒä¹ çš„é”™é¢˜é¢˜å‹</h3>
            <div class="flex flex-wrap justify-center gap-4">
                <button @click="wrongBrush.startPracticeByType('single')" class="btn btn-outline btn-primary"
                        :disabled="wrongBrush.counts.single === 0">
                    å•é€‰é¢˜ <span class="badge" x-text="wrongBrush.counts.single"></span>
                </button>
                <button @click="wrongBrush.startPracticeByType('multiple')" class="btn btn-outline btn-secondary"
                        :disabled="wrongBrush.counts.multiple === 0">
                    å¤šé€‰é¢˜ <span class="badge" x-text="wrongBrush.counts.multiple"></span>
                </button>
                <button @click="wrongBrush.startPracticeByType('judge')" class="btn btn-outline btn-accent"
                        :disabled="wrongBrush.counts.judge === 0">
                    åˆ¤æ–­é¢˜ <span class="badge" x-text="wrongBrush.counts.judge"></span>
                </button>
                <button @click="wrongBrush.startPracticeByType('all')" class="btn btn-neutral"
                        :disabled="wrongBrush.counts.total === 0">å…¨éƒ¨é”™é¢˜
                </button>
            </div>
        </div>

        <div x-show="wrongBrush.isPracticeStarted && !wrongBrush.isEmpty">
            <div x-show="wrongBrush.currentQuestion"
                 class="text-center font-bold text-lg my-4 p-2 bg-info/20 text-info-content rounded-lg"
                 x-text="wrongBrush.sectionTitle" x-transition>
            </div>

            <div x-show="wrongBrush.currentQuestion" class="card bg-base-100" x-transition>
                <div class="card-body">
                    <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
                        <h2 class="card-title">é”™é¢˜ç»ƒä¹ </h2>
                        <div class="text-sm font-semibold">
                            <span>è¿›åº¦: <span x-text="wrongBrush.currentQuestionIndex + 1"></span> / <span
                                    x-text="wrongBrush.stats.total"></span></span> |
                            <span class="text-green-500">æ­£ç¡®: <span x-text="wrongBrush.stats.correct"></span></span> |
                            <span class="text-red-500">é”™è¯¯: <span x-text="wrongBrush.stats.incorrect"></span></span>
                        </div>
                    </div>
                    <div class="p-4 border rounded-lg bg-base-200">
                        <p class="font-semibold text-lg mb-4" x-text="wrongBrush.displayQuestionText"></p>
                        <div class="space-y-2">
                            <template
                                    x-if="wrongBrush.currentQuestion.type === 'single' || wrongBrush.currentQuestion.type === 'judge'">
                                <template x-for="option in wrongBrush.currentQuestion.options" :key="option">
                                    <label @click.prevent="wrongBrush.selectAndCheck(option.charAt(0))"
                                           class="option-label" :class="wrongBrush.getOptionClass(option)">
                                        <span x-text="option"></span>
                                    </label>
                                </template>
                            </template>
                            <template x-if="wrongBrush.currentQuestion.type === 'multiple'">
                                <template x-for="option in wrongBrush.currentQuestion.options" :key="option">
                                    <label class="option-label option-label-multi"
                                           :class="wrongBrush.getOptionClass(option)">
                                        <input type="checkbox" :value="option.charAt(0)"
                                               x-model="wrongBrush.userSelection" class="checkbox checkbox-primary mr-3"
                                               :disabled="wrongBrush.isAnswerChecked">
                                        <span x-text="option"></span>
                                    </label>
                                </template>
                            </template>
                        </div>
                    </div>
                    <div x-show="wrongBrush.isAnswerChecked"
                         class="mt-4 p-3 rounded-lg font-bold"
                         :class="{ 'bg-green-100 text-green-800': wrongBrush.isCorrect, 'bg-red-100 text-red-800': !wrongBrush.isCorrect }"
                         x-transition>
                        <span>æ­£ç¡®ç­”æ¡ˆ: <span x-text="wrongBrush.currentQuestion.correctAnswer"></span></span>
                        <div x-show="!wrongBrush.isCorrect" class="text-sm font-normal mt-1">
                            è¿™é“é¢˜å·²åœ¨ä½ çš„é”™é¢˜æœ¬ä¸­ã€‚è¿ç»­ç­”å¯¹3æ¬¡åå°†è‡ªåŠ¨ç§»é™¤ã€‚
                        </div>
                    </div>
                    <div class="card-actions justify-between mt-6">
                        <button @click="wrongBrush.reset()" class="btn btn-ghost">è¿”å›</button>
                        <div>
                            <button @click="wrongBrush.prevQuestion()" class="btn"
                                    :disabled="wrongBrush.currentQuestionIndex <= 0">â† ä¸Šä¸€é¢˜
                            </button>
                            <button @click="wrongBrush.nextQuestion()" class="btn btn-secondary"
                                    :disabled="wrongBrush.currentQuestionIndex >= wrongBrush.practicePool.length - 1">
                                ä¸‹ä¸€é¢˜ â†’
                            </button>
                            <button @click="wrongBrush.checkAnswer()"
                                    x-show="wrongBrush.currentQuestion && wrongBrush.currentQuestion.type === 'multiple' && !wrongBrush.isAnswerChecked"
                                    class="btn btn-primary mx-2">æäº¤
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="!wrongBrush.currentQuestion && wrongBrush.isPracticeStarted"
                 class="card bg-base-100 text-center p-8" x-transition>
                <h2 class="card-title text-2xl mx-auto">ğŸ‰ æœ¬è½®ç»ƒä¹ å®Œæˆ! ğŸ‰</h2>
                <div class="stats shadow mx-auto my-4">
                    <div class="stat">
                        <div class="stat-title">æ€»é¢˜æ•°</div>
                        <div class="stat-value" x-text="wrongBrush.stats.total"></div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">æ­£ç¡®</div>
                        <div class="stat-value text-green-500" x-text="wrongBrush.stats.correct"></div>
                    </div>
                    <div class="stat">
                        <div class="stat-title">é”™è¯¯</div>
                        <div class="stat-value text-red-500" x-text="wrongBrush.stats.incorrect"></div>
                    </div>
                </div>
                <div class="card-actions justify-center mt-6">
                    <button @click="wrongBrush.reset()" class="btn btn-primary">å†æ¥ä¸€è½®</button>
                </div>
            </div>
        </div>

        <div x-show="wrongBrush.isEmpty" class="text-center p-8 bg-base-100 rounded-lg" x-transition>
            <p class="text-xl font-semibold">ğŸ‘ é”™é¢˜åº“æ˜¯ç©ºçš„!</p>
            <p class="mt-2 text-base-content/70">ä½ è¿˜æ²¡æœ‰ç­”é”™è¿‡é¢˜ç›®ï¼Œæˆ–è€…å·²ç»æŠŠæ‰€æœ‰é”™é¢˜éƒ½æ¶ˆç­äº†ã€‚çœŸæ£’ï¼</p>
        </div>
    </div>
</div>
</body>
</html>